name: Create API Manager instances in Dev/Prod
on:
  workflow_dispatch:

jobs:
  create_apim_instance:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    # Install Node on the runner
    - uses: actions/setup-node@v4
      with:
        node-version: 18
    - name: Install anypoint-cli
      run: |
        npm install -g anypoint-cli-v4
    - name: check version
      run: |
        anypoint-cli-v4 --version
    - name: Set Authentication
      env:
        MULE_CLIENT_ID: ${{ secrets.MULE_CLIENT_ID }}
        MULE_CLIENT_SECRET: ${{ secrets.MULE_CLIENT_SECRET }}
        MULE_ORG_ID: ${{ vars.MULE_ORG_ID }}
      run: |
        anypoint-cli-v4 conf client_id $MULE_CLIENT_ID
        anypoint-cli-v4 conf client_secret $MULE_CLIENT_SECRET
        anypoint-cli-v4 conf organization $MULE_ORG_ID
    - name: Verify configuration
      run: |
        anypoint-cli-v4 account:environment:list
